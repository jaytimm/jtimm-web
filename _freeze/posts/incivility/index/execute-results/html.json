{
  "hash": "206ab893b2304563018a83f6f113f22b",
  "result": {
    "markdown": "---\ntitle: \"incivility on twitter & political ideology\"\ndescription: \"A look at the prevalence of incivility towards US lawmakers on Twitter\"\ndate: \"2022-06-28\"\ncategories: [twitter, american politics, classification]\n  \nformat:\n  html:\n    toc: true\n    toc-depth: 2\n    number-sections: true\n    \nbibliography: /home/jtimm/pCloudDrive/GitHub/jtimm_web/biblio.bib\nimage: preview.png\n---\n\n\n![](preview2.png){width=100% .preview-image}\n\n\n\n---\n\n> Per @theocharis2020dynamics.   A look at the prevalence of incivility towards US lawmakers on Twitter using supervised machine learning methods.  \n\n\n\n\n## Classifier\n\nThe authors make their \"incivility classifier\" available [here](https://github.com/pablobarbera/incivility-sage-open).  \n\n::: {.cell}\n\n```{.r .cell-code}\nsetwd(locald)\nlibrary(quanteda)\nlibrary(glmnet)\nsource(\"incivility-sage-open-master/functions.R\")\nload(\"incivility-sage-open-master/data/lasso-classifier.rdata\")\nload(\"incivility-sage-open-master/data/dfm-file.rdata\")\n```\n:::\n\n\n\n\n\n## House members: details & ideology scores\n\nThe [unitedstates project](https://theunitedstates.io/) provides demographic info and social details for members of congress.  \n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(dplyr)\nleg_dets <- 'https://theunitedstates.io/congress-legislators/legislators-current.csv'\nreps <- read.csv((url(leg_dets)), stringsAsFactors = FALSE) |>\n  dplyr::filter(type == 'rep')\n```\n:::\nThe package [Rvoteview](https://github.com/voteview/Rvoteview) provides access to the [Voteview](https://voteview.com/) database and DW-Nominate ideology scores for US lawmakers.\n\n::: {.cell}\n\n```{.r .cell-code}\nhouse_members <- Rvoteview::download_metadata(type = 'members',\n                                              chamber = 'house',\n                                              congress = '117') \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"/tmp/RtmpIn1JfV/H117_members.csv\"\n```\n:::\n:::\n\n\n\n## Twitter data\n\n### Collect tweets\n\nWe use the `rtweet` package to gather the most recent tweets mentioning each member of the US House of Representatives.  Here, \"mention\" is in the Twitter sense, ie, a username prefixed with the `@` symbol.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntweet_set <- lapply(paste0('@', reps$twitter),\n                    function(x) {\n                      ts <- rtweet::search_tweets(\n                        q = x,\n                        ## n = 200,\n                        type = \"recent\",\n                        include_rts = FALSE,\n                        geocode = NULL,\n                        max_id = NULL,\n                        parse = TRUE,\n                        token = tk,\n                        retryonratelimit = TRUE)\n                      \n                      if(nrow(ts) == 0) {return(NA)} else{\n                        \n                        ts |> dplyr::select(1:5)\n                      }\n                      }\n                    )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(tweet_set) <- reps$bioguide_id\ntweet_set0 <- Filter(length, tweet_set)\ntweet_set1 <- Filter(function(a) any(!is.na(a)), tweet_set0)\ntweet_set2 <- tweet_set1 |> data.table::rbindlist(idcol = 'bioguide_id') \n```\n:::\n\n\n\n### Classify civility\n\n::: {.cell}\n\n```{.r .cell-code}\ntweet_set2$incivil <- predict_incivility(tweet_set2$text, \n                                         old_dfm = dfm,\n                                         classifier = lasso)\n```\n:::\n\n\n\n\n\n\n\n### Filter tweets\n\nSubset tweet corpus to only those that mention a *single* US lawmaker.  \n\n::: {.cell}\n\n```{.r .cell-code}\ntweet_set3 <- tweet_set2 |> \n  mutate(ats = stringr::str_count(text, pattern = '\\\\@')) |>\n  filter(ats == 1)\n```\n:::\n\n\n@theocharis2020dynamics 's classifier computes the probability that given tweet is uncivil.  One approach is to treat that probability as an incivility score; another is to convert the probability into a categorical variable, +/- uncivil.  Here, we implement the former.  \n\n::: {.cell}\n\n```{.r .cell-code}\ntsum <- tweet_set3 |> \n  mutate(is_uncivil = ifelse(incivil > 0.5, 1, 0)) |>\n  group_by(bioguide_id) |>\n  summarise(mean_score = mean(incivil),\n            mentions = n(),\n            uncivil_mentions = sum(is_uncivil)) |>\n  dplyr::ungroup() |>\n  mutate(per_uncivil = round(uncivil_mentions/mentions*100, 1)) |>\n  merge(reps)\n```\n:::\n\n\n\n### Sample tweets\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(99)\ntweet_set3 |>\n  inner_join(reps) |>\n  filter(incivil > .75) |>\n  sample_n(5) %>%\n  select(full_name, state, party, text) |>\n  DT::datatable(rownames = F)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-69bde17f659f0c13e39e\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-69bde17f659f0c13e39e\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"Andy Biggs\",\"Liz Cheney\",\"Troy E. Nehls\",\"Nancy Pelosi\",\"Marjorie Taylor Greene\"],[\"AZ\",\"WY\",\"TX\",\"CA\",\"GA\"],[\"Republican\",\"Republican\",\"Republican\",\"Democrat\",\"Republican\"],[\"@RepAndyBiggsAZ No it‚Äôs not.  It‚Äôs a clump of cells.  Scientific FACT.  Even the Bible says ‚Äúfirst breath‚Äù is when life begins. You calling the Bible a liar?\",\"@RepLizCheney I am very disappointed in you encouraging and promoting this. Nobody disagrees that Trump is a jerk of a human, no better than most politicians, but this is a joke and a hoax! You aren't showing the whole picture! It's all very skewed to con the average Democrat! SMH! ü§¶‚Äç‚ôÇÔ∏èüí©\",\"@RepTroyNehls You already know inflation is essentially compound\\nStop false flagging fuckwit\\n40 year ath is deceptive as shit.\\nGive us the comparison to when shitty fiat was released.\\n\\nOr are you afraid we'll start wising up?\",\"@SpeakerPelosi Such bullshit.\",\"@RepMTG Good for u. We need a lot more like u in Congress. Keep fighting for all of us not insane people\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>full_name<\\/th>\\n      <th>state<\\/th>\\n      <th>party<\\/th>\\n      <th>text<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n## Incivility & ideology\n\nPer plot below, then, tweeters tend to be less civil when mentioning (or addressing) more ideologically extreme members of Congress in their tweets.\n\n::: {.cell figure.width='100%'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\ntsum |>\n  merge(house_members) |>\n  filter(mean_score < 0.5) |>\n  ggplot(aes(nominate_dim1, \n             mean_score, #per_uncivil, \n             color = as.factor(party),\n             label = last_name))+ \n  geom_point()+ #\n  geom_smooth(method=\"lm\", se=T) +\n  \n  ggrepel::geom_text_repel(\n    nudge_y = -0.0025,\n    segment.color = \"grey50\",\n    direction = \"y\",\n    hjust = 0, \n    size = 2.5 ) +\n  \n  ggthemes::scale_color_stata() +\n  theme(legend.position = \"none\", \n        plot.title = element_text(size=12),\n        axis.title = element_text())+\n  xlab('DW-Nominate D1') + ylab('Mean Incivility') +\n  labs(title=\"DW-Nominate scores & Mean Incivility scores\") \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.23/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}