{
  "hash": "02cd69c40cadbc0d904a3f442fc68645",
  "result": {
    "markdown": "---\ntitle: \"linking entities and wikidata\"\ndate: \"2022-06-26\"\ncategories: [nlp, ner, python]\ndescription: \"A quick demo using the spacyfishing python library\"\n\nbibliography: /home/jtimm/pCloudDrive/GitHub/jtimm_web/biblio.bib\nimage: preview.png\n\nformat:\n  html:\n    toc: true\n    toc-depth: 2\n    number-sections: true\n---\n\n\n![](preview.png){width=100% .preview-image}\n\n\n---\n\n\n> A quick demo using the [spacyfishing](https://github.com/Lucaterre/spacyfishing) library -- \"a spaCy wrapper for Entity-Fishing, a tool for named entity recognition, linking and disambiguation against Wikidata.\"  Facilitates disambiguating/linking named entities to the Wikidata knowledge base.\n\n\n\n## Reticulate & Python\n\n::: {.cell}\n\n```{.bash .cell-code}\nconda create -n fishing\nsource activate fishing\nconda install numpy pip pandas\n/home/jtimm/anaconda3/envs/fishing/bin/pip install spacyfishing\npython -m spacy download en_core_web_sm\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nSys.setenv(RETICULATE_PYTHON = \"/home/jtimm/anaconda3/envs/fishing/bin/python\")\nreticulate::use_condaenv(condaenv = \"fishing\",\n                         conda = \"/home/jtimm/anaconda3/bin/conda\")\n```\n:::\n\n## Build a simple news corpus\n\n::: {.cell}\n\n```{.r .cell-code}\nqn <- quicknews::qnews_build_rss('war in ukraine') |>\n  quicknews::qnews_strip_rss()\n\nqn[1:5,1:3] |> knitr::kable() \n```\n\n::: {.cell-output-display}\n|date       |source              |title                                                              |\n|:----------|:-------------------|:------------------------------------------------------------------|\n|2022-06-28 |NPR                 |Russia-Ukraine war: What happened today (June 28)                  |\n|2022-06-28 |The Washington Post |Latest Russia-Ukraine war news: Live updates                       |\n|2022-06-28 |VOA News            |Latest Developments in Ukraine: June 28                            |\n|2022-06-28 |The New York Times  |The West Seeks a More Effective Way to Tighten Sanctions on Russia |\n|2022-06-28 |CNN                 |Russia's war in Ukraine: Live updates                              |\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\narts <- quicknews::qnews_extract_article(qn$link[1:3], cores = 3)\ntext_en <- arts$text[1]\n```\n:::\n\n## spaCy\n\n\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport spacy \nnlp = spacy.load(\"en_core_web_sm\")\nnlp.add_pipe(\"entityfishing\", config={\"extra_info\": True})\nnlp.add_pipe('sentencizer')\n```\n:::\n\n\n::: {.cell}\n\n```{.python .cell-code}\ndoc = nlp(r.text_en)\n```\n:::\n\n\n\n### Entities to Wikipedia\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\nentities = [(e.label_, \n             e.text, \n             e._.normal_term, \n             e._.kb_qid, \n             e._.url_wikidata, \n             e._.nerd_score,\n             e._.description) for e in doc.ents]\n             \ndf99 = pd.DataFrame(entities, \n                    columns=['type',\n                             'entity', \n                             'normed', \n                             'qid', \n                             'url', \n                             'score', \n                             'description'])\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreticulate::py$df99 |> \n  dplyr::select(-description) |> \n  DT::datatable(rownames = F)\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"htmlwidget-eafd7a7cb6e1464e81fe\" style=\"width:100%;height:auto;\" class=\"datatables html-widget\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-eafd7a7cb6e1464e81fe\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"DATE\",\"PERSON\",\"LOC\",\"GPE\",\"DATE\",\"NORP\",\"CARDINAL\",\"DATE\",\"GPE\",\"ORG\",\"ORG\",\"DATE\",\"GPE\",\"GPE\",\"ORG\",\"ORG\",\"GPE\",\"GPE\",\"GPE\",\"GPE\",\"GPE\",\"GPE\",\"GPE\",\"GPE\",\"ORG\",\"PERSON\",\"GPE\",\"GPE\",\"DATE\",\"ORG\",\"GPE\",\"PERSON\",\"ORG\",\"GPE\",\"GPE\",\"GPE\",\"NORP\",\"GPE\",\"ORG\",\"GPE\",\"GPE\",\"GPE\",\"CARDINAL\",\"NORP\",\"ORG\",\"GPE\",\"ORG\",\"GPE\",\"ORG\",\"NORP\",\"NORP\",\"PERSON\",\"GPE\",\"DATE\",\"NORP\",\"PERSON\",\"GPE\",\"DATE\",\"ORG\",\"PERSON\",\"DATE\",\"DATE\",\"NORP\",\"ORG\",\"DATE\",\"GPE\",\"GPE\"],[\"Tuesday\",\"Amstor mall\",\"Kremenchuk\",\"Ukraine\",\"one day\",\"Russian\",\"at least 20\",\"Monday\",\"Ukrainian\",\"Kremenchuk\",\"Group of Seven\",\"Tuesday\",\"Russia\",\"Russia\",\"Ukraine\",\"NATO\",\"Madrid\",\"Turkey\",\"Finland\",\"Sweden\",\"Turkey\",\"Finland\",\"Sweden\",\"Turkey\",\"NATO\",\"Jens Stoltenberg\",\"Finland\",\"Sweden\",\"Wednesday\",\"NATO\",\"Ukrainian\",\"Volodymyr Zelenskyy\",\"the United Nations Security Council\",\"Russia\",\"Ukraine\",\"Ukrainian\",\"Russian\",\"Russia\",\"U.N.\",\"U.S.\",\"Russia\",\"Ukraine\",\"70\",\"Russian\",\"Rostec\",\"Russia\",\"the State Department\",\"U.S.\",\"G-7\",\"Russian\",\"Russian\",\"Ilya Yashin\",\"Moscow\",\"15 days\",\"Russian\",\"Yashin\",\"Ukraine\",\"April\",\"Kremlin\",\"Vladimir Kara-Murza\",\"15-day\",\"months\",\"European\",\"NATO\",\"years\",\"Russia\",\"Ukraine\"],[\"Tuesday\",null,\"Kremenchuk\",\"Ukraine\",\"List A cricket\",\"Russian language\",null,\"Monday\",\"Ukraine\",\"Kremenchuk\",\"Group of Seven (artists)\",\"Tuesday\",\"Russia\",\"Russia\",\"Ukraine\",\"NATO\",\"Madrid\",\"Turkey\",\"Finland\",\"Sweden\",\"Turkey\",\"Finland\",\"Sweden\",\"Turkey\",\"NATO\",\"Jens Stoltenberg\",\"Finland\",\"Sweden\",\"Wednesday\",\"NATO\",\"Ukraine\",null,null,\"Russia\",\"Ukraine\",\"Ukraine\",\"Russian language\",\"Russia\",\"United Nations\",\"United States\",\"Russia\",\"Ukraine\",\"Melbourne tram route 70\",\"Russian language\",\"Rostec\",\"Russia\",\"United States Department of State\",\"United States\",\"Prince G engine\",\"Russian language\",\"Russian language\",\"Ilya Yashin\",\"Moscow\",null,\"Russian language\",\"Yashin (band)\",\"Ukraine\",\"April\",\"Moscow Kremlin\",\"Vladimir Vladimirovich Kara-Murza\",null,\"Month\",\"Ethnic groups in Europe\",\"NATO\",\"Year\",\"Russia\",\"Ukraine\"],[\"Q127\",null,\"Q156724\",\"Q212\",\"Q1628688\",\"Q7737\",null,\"Q105\",\"Q212\",\"Q156724\",\"Q1547741\",\"Q127\",\"Q159\",\"Q159\",\"Q212\",\"Q7184\",\"Q2807\",\"Q43\",\"Q33\",\"Q34\",\"Q43\",\"Q33\",\"Q34\",\"Q43\",\"Q7184\",\"Q57665\",\"Q33\",\"Q34\",\"Q128\",\"Q7184\",\"Q212\",null,null,\"Q159\",\"Q212\",\"Q212\",\"Q7737\",\"Q159\",\"Q1065\",\"Q30\",\"Q159\",\"Q212\",\"Q6811967\",\"Q7737\",\"Q1840188\",\"Q159\",\"Q789915\",\"Q30\",\"Q7243991\",\"Q7737\",\"Q7737\",\"Q1658622\",\"Q649\",null,\"Q7737\",\"Q2599675\",\"Q212\",\"Q118\",\"Q133274\",\"Q4213414\",null,\"Q5151\",\"Q1464982\",\"Q7184\",\"Q577\",\"Q159\",\"Q212\"],[\"https://www.wikidata.org/wiki/Q127\",null,\"https://www.wikidata.org/wiki/Q156724\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q1628688\",\"https://www.wikidata.org/wiki/Q7737\",null,\"https://www.wikidata.org/wiki/Q105\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q156724\",\"https://www.wikidata.org/wiki/Q1547741\",\"https://www.wikidata.org/wiki/Q127\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q7184\",\"https://www.wikidata.org/wiki/Q2807\",\"https://www.wikidata.org/wiki/Q43\",\"https://www.wikidata.org/wiki/Q33\",\"https://www.wikidata.org/wiki/Q34\",\"https://www.wikidata.org/wiki/Q43\",\"https://www.wikidata.org/wiki/Q33\",\"https://www.wikidata.org/wiki/Q34\",\"https://www.wikidata.org/wiki/Q43\",\"https://www.wikidata.org/wiki/Q7184\",\"https://www.wikidata.org/wiki/Q57665\",\"https://www.wikidata.org/wiki/Q33\",\"https://www.wikidata.org/wiki/Q34\",\"https://www.wikidata.org/wiki/Q128\",\"https://www.wikidata.org/wiki/Q7184\",\"https://www.wikidata.org/wiki/Q212\",null,null,\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q7737\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q1065\",\"https://www.wikidata.org/wiki/Q30\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q6811967\",\"https://www.wikidata.org/wiki/Q7737\",\"https://www.wikidata.org/wiki/Q1840188\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q789915\",\"https://www.wikidata.org/wiki/Q30\",\"https://www.wikidata.org/wiki/Q7243991\",\"https://www.wikidata.org/wiki/Q7737\",\"https://www.wikidata.org/wiki/Q7737\",\"https://www.wikidata.org/wiki/Q1658622\",\"https://www.wikidata.org/wiki/Q649\",null,\"https://www.wikidata.org/wiki/Q7737\",\"https://www.wikidata.org/wiki/Q2599675\",\"https://www.wikidata.org/wiki/Q212\",\"https://www.wikidata.org/wiki/Q118\",\"https://www.wikidata.org/wiki/Q133274\",\"https://www.wikidata.org/wiki/Q4213414\",null,\"https://www.wikidata.org/wiki/Q5151\",\"https://www.wikidata.org/wiki/Q1464982\",\"https://www.wikidata.org/wiki/Q7184\",\"https://www.wikidata.org/wiki/Q577\",\"https://www.wikidata.org/wiki/Q159\",\"https://www.wikidata.org/wiki/Q212\"],[0.0826,null,0.7267,0.3848,0.2388,0.1155,null,0.0826,0.2049,0.7267,0.6646,0.0826,0.3661,0.3661,0.3848,0.4438,0.3578,0.3849,0.363,0.3498,0.3849,0.363,0.3498,0.3849,0.4438,0.9693,0.363,0.3498,0.0826,0.4438,0.2049,null,null,0.3661,0.3848,0.2049,0.1155,0.3661,0.5167,0.4195,0.3661,0.3848,0.0826,0.1155,0.471,0.3661,0.383,0.4195,0.1287,0.1155,0.1155,0.8017,0.3918,null,0.1155,0.1062,0.3848,0.0826,0.3095,0.6563,null,0.0898,0.0826,0.4438,0.0826,0.3661,0.3848]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th>type<\\/th>\\n      <th>entity<\\/th>\\n      <th>normed<\\/th>\\n      <th>qid<\\/th>\\n      <th>url<\\/th>\\n      <th>score<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"className\":\"dt-right\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n:::\n:::\n\n\n\n### Wikidata description\n\n::: {.cell}\n\n```{.r .cell-code}\nstrwrap(reticulate::py$df99$description[[3]], width = 60)[1:10]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"'''Kremenchuk''' (, ;, [[Romanization of\"                   \n [2] \"Russian|translit.]] ''Kremenchug''), an important\"          \n [3] \"industrial [[city]] in central [[Ukraine]], stands on the\"  \n [4] \"banks of the [[Dnieper]] River. Kremenchuk is the [[Capital\"\n [5] \"city|administrative center]] of the [[Kremenchuk Raion]]\"   \n [6] \"([[Raion|district]]) in [[Poltava Oblast]]\"                 \n [7] \"([[Oblast|province]]). Kremenchuk is administratively\"      \n [8] \"incorporated as a [[City of regional significance\"          \n [9] \"(Ukraine)|city of oblast significance]] and does not belong\"\n[10] \"to the raion. Population: Along with [[Svitlovodsk]] and\"   \n```\n:::\n:::\n\n\n\n## displaCy\n\n\n```{.python .cell-code}\nfrom spacy import displacy\nss = list(doc.sents)\n\ndisplacy.render(ss[:4], style=\"ent\")\n```\n\n'<div class=\"entities\" style=\"line-height: 2.5; direction: ltr\">A photograph taken \\n<mark class=\"entity\" style=\"background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Tuesday\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">DATE</span>\\n</mark>\\n shows charred goods in a grocery store of the destroyed \\n<mark class=\"entity\" style=\"background: #aa9cfc; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Amstor mall\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">PERSON</span>\\n</mark>\\n in \\n<mark class=\"entity\" style=\"background: #ff9561; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Kremenchuk\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">LOC</span>\\n</mark>\\n, central \\n<mark class=\"entity\" style=\"background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Ukraine\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">GPE</span>\\n</mark>\\n, \\n<mark class=\"entity\" style=\"background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    one day\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">DATE</span>\\n</mark>\\n after it was hit by a \\n<mark class=\"entity\" style=\"background: #c887fb; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Russian\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">NORP</span>\\n</mark>\\n missile strike. </div>\\n\\n<div class=\"entities\" style=\"line-height: 2.5; direction: ltr\">The death toll climbed to \\n<mark class=\"entity\" style=\"background: #e4e7d2; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    at least 20\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">CARDINAL</span>\\n</mark>\\n after \\n<mark class=\"entity\" style=\"background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Monday\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">DATE</span>\\n</mark>\\n\\'s missile attack on a crowded mall in the central \\n<mark class=\"entity\" style=\"background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Ukrainian\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">GPE</span>\\n</mark>\\n city of \\n<mark class=\"entity\" style=\"background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Kremenchuk\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">ORG</span>\\n</mark>\\n, which leaders at a \\n<mark class=\"entity\" style=\"background: #7aecec; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Group of Seven\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">ORG</span>\\n</mark>\\n meeting called a &quot;war crime.&quot; </div>\\n\\n<div class=\"entities\" style=\"line-height: 2.5; direction: ltr\">On \\n<mark class=\"entity\" style=\"background: #bfe1d9; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Tuesday\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">DATE</span>\\n</mark>\\n, emergency responders ended a rescue search for survivors. </div>\\n\\n<div class=\"entities\" style=\"line-height: 2.5; direction: ltr\">\\n<mark class=\"entity\" style=\"background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Russia\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">GPE</span>\\n</mark>\\n\\'s government denied hitting the shopping center, claiming it caught fire after \\n<mark class=\"entity\" style=\"background: #feca74; padding: 0.45em 0.6em; margin: 0 0.25em; line-height: 1; border-radius: 0.35em;\">\\n    Russia\\n    <span style=\"font-size: 0.8em; font-weight: bold; line-height: 1; border-radius: 0.35em; vertical-align: middle; margin-left: 0.5rem\">GPE</span>\\n</mark>\\n struck a nearby weapons depot. </div>'\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/htmlwidgets-1.5.4/htmlwidgets.js\"></script>\n<link href=\"../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/datatables-binding-0.23/datatables.js\"></script>\n<script src=\"../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../../site_libs/dt-core-1.11.3/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/dt-core-1.11.3/js/jquery.dataTables.min.js\"></script>\n<link href=\"../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}